<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="pataqu">
<title>Introducing pataqu • pataqu</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introducing pataqu">
<meta property="og:description" content="pataqu">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pataqu</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro.html">Introducing pataqu</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/vbonhomme/pataqu/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="intro_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introducing pataqu</h1>
                        <h4 data-toc-skip class="author">Vincent Bonhomme, Allowen Evin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vbonhomme/pataqu/blob/HEAD/vignettes/intro.Rmd" class="external-link"><code>vignettes/intro.Rmd</code></a></small>
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<p>pataqu aims at visualizing and testing the effect of uncertainties on x values (ie the independant variable). This vignette quickly presents the rationale of the package then jump to a case study.</p>
<div class="section level2">
<h2 id="rationale">Rationale<a class="anchor" aria-label="anchor" href="#rationale"></a>
</h2>
<div class="section level3">
<h3 id="sources-of-uncertainties">Sources of uncertainties<a class="anchor" aria-label="anchor" href="#sources-of-uncertainties"></a>
</h3>
<p>We chiefly had in mind archaeological data which dating of remains are often temporally bounded between two certain events, named <em>terminus post/ante quem</em>, further abbreviated tpq and taq<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;hence the package name which is also a delicate pun, in French&lt;/p&gt;"><sup>1</sup></a>. The tpq is the earliest date, the taq the latest.</p>
<p>The <em>real</em> event may have happened anytime between these two boundaries with a flat, uniform, density of probability along the interval.</p>
<p>We can also think of radiocarbon dating, which comes with a prediction and a confidence interval (say <span class="math inline">\(\mu ± \sigma\)</span>). But here the dating differ and the <em>real</em> event has a density of probability of gaussian nature with parameters <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>.</p>
</div>
<div class="section level3">
<h3 id="consequences-and-how-to-inspect-them">Consequences and how to inspect them<a class="anchor" aria-label="anchor" href="#consequences-and-how-to-inspect-them"></a>
</h3>
<p>Whatever the source of the uncertainty, the graphics, tests and overall stories we can obtain from data may well be affected. How robust your lovely trends to temporal uncertainties?</p>
<p>pataqu aims at visualizing and testing this using permutations. This is not the only way to do it but in our view it has the merit to only use information contained in the data itself.</p>
<p>The idea is:</p>
<ol style="list-style-type: decimal">
<li>Simulate plausible new x values</li>
<li>Display and/or test what you need</li>
<li>Repeat many times and see what happens</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="case-study-taq-and-ptq">Case study: taq and ptq<a class="anchor" aria-label="anchor" href="#case-study-taq-and-ptq"></a>
</h2>
<p>We will load the package and also use <code>dplyr</code> and <code>ggplot2</code> from the <a href="tidyverse.org/">tidyverse</a>. Overall, if you <code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code> you should not need much more<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;and typically you will not need to &lt;code&gt;dplyr::&lt;/code&gt; or &lt;code&gt;ggplot2::&lt;/code&gt; like what you have in function examples.&lt;/p&gt;"><sup>2</sup></a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vbonhomme/pataqu" class="external-link">pataqu</a></span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="animals-dataset">
<code>animals</code> dataset<a class="anchor" aria-label="anchor" href="#animals-dataset"></a>
</h3>
<p>This dataset is made of real (and unpublished) data where researchers measured a <code>value</code> of interest on archaeological remains, in several <code>sites</code> (with <code>us</code> or stratigraphical units in them), dated with <code>tpq</code> and <code>taq</code>. The remains belonged to four <code>taxa</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">animals</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span>
<span class="co">#&gt;   taxa  site   us        tpq   taq   value</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> frog  Alz-Br A-B_FO   -<span style="color: #BB0000;">125</span>   -<span style="color: #BB0000;">50</span> -<span style="color: #BB0000;">0.035</span><span style="color: #BB0000; text-decoration: underline;">2</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> frog  Ans-lM A-M_12     50   700 -<span style="color: #BB0000;">0.123</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> frog  Ans-lM A-M_12     50   700 -<span style="color: #BB0000;">0.129</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> frog  Ans-lM A-M_139   150   200  0.120 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> frog  Ans-lM An-M_15    50   700  0.057<span style="text-decoration: underline;">5</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> frog  Ans-lM A-M_150    50   200  0.052<span style="text-decoration: underline;">8</span></span>
<span class="co"># We only show the first lines but you can View(animals)</span></code></pre></div>
<p>How would we treat that? We could decide to display the full interval and see what happens:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pure cosmetics for lighter graphs</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">animals</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html" class="external-link">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="va">tpq</span>, xmax<span class="op">=</span><span class="va">taq</span>, y<span class="op">=</span><span class="va">value</span>, col<span class="op">=</span><span class="va">taxa</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.2</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="intro_files/figure-html/gg_errorh-1.png" width="700"></p>
<p>What a mess! We could try to add a mid point and add a smoother on top of them.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">animals</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x_new<span class="op">=</span><span class="op">(</span><span class="va">tpq</span><span class="op">+</span><span class="va">taq</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x_new</span>, y<span class="op">=</span><span class="va">value</span>, col<span class="op">=</span><span class="va">taxa</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"loess"</span>, formula<span class="op">=</span><span class="st">"y~x"</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">gg_mid</span>
<span class="va">gg_mid</span></code></pre></div>
<p><img src="intro_files/figure-html/gg_mid1-1.png" width="700"> We now are able to see some trends but we lost the uncertainty on x in the meantime. The graph before may have also been the one below, with the same likelihood.</p>
<p>We take animals and simply draw other <code>x_new</code> values, not on the midpoint, somewhere between the tpq and taq of each line. We use <code>set.seed</code> for the sake of replicability only.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2329</span><span class="op">)</span>
<span class="co"># lets draw new x values</span>
<span class="va">animals2</span> <span class="op">&lt;-</span> <span class="va">animals</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x_new<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, min<span class="op">=</span><span class="va">tpq</span>, max<span class="op">=</span><span class="va">taq</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># and redo gg_mid graph with this new tibble</span>
<span class="va">gg_mid</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html" class="external-link">%+%</a></span> <span class="va">animals2</span></code></pre></div>
<p><img src="intro_files/figure-html/gg_mid_animals2-1.png" width="700"></p>
<p>Same same but different.</p>
<p>The code used above is exactly what <code>shake_uniform</code> is made of behind the curtain<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;check by yourself and type &lt;code&gt;&lt;a href="../reference/shake.html"&gt;pataqu::shake_uniform&lt;/a&gt;&lt;/code&gt; (no brackets) in the console&lt;/p&gt;'><sup>3</sup></a>. Have a look to the different shakers with <code><a href="../reference/shake.html">?shake</a></code></p>
<p>pataqu generalizes this idea with a decoration around this pattern.</p>
<p>The mother function for doing permutations is <code>quake</code>. We will simulate 5 new datasets with randomized datations. We want to use <code>shake_uniform</code> for which we need to specify the column for <code>tpq</code> and <code>taq</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quake.html">quake</a></span><span class="op">(</span><span class="va">animals</span>, k<span class="op">=</span><span class="fl">5</span>, shaker<span class="op">=</span><span class="va">shake_uniform</span>, min<span class="op">=</span><span class="va">tpq</span>, max<span class="op">=</span><span class="va">taq</span><span class="op">)</span>
<span class="co">#&gt;  * quake animals using shake_uniform</span>
<span class="co">#&gt;  * launching 5 permutations</span></code></pre></div>
<!-- <!-- -->
<!-- Let's have a look to the results: -->
<!-- ```{r} -->
<!-- a_q -->
<!-- # spaghetti(a_q) -->
<!-- ``` -->
<!-- One can now test _globally_ when patterns between taxa differ: -->
<!-- ```{r} -->
<!-- res_global <- a_q %>% synchrony() -->
<!-- res_global %>% filter(p<1e-4) -->
<!-- ``` -->
<!-- But also test for pairwise differences: -->
<!-- ```{r} -->
<!-- res <- a_q %>% synchrony_pw() -->
<!-- head(res) -->
<!-- ``` -->
<!-- And we can also check only those that differ: -->
<!-- ```{r} -->
<!--  res %>% filter(p<0.0001) -->
<!-- ``` -->
<!-- -->
<p>–&gt;</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Vincent Bonhomme, Allowen Evin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
